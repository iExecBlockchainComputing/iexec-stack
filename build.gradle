group 'org.web3j'
version '0.0.1'

apply plugin: 'java'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

ext {
    web3jVersion = '3.2.0'
    logbackVersion = '1.2.3'
    junitVersion = '4.12'
}

dependencies {
    compile "org.web3j:core:$web3jVersion",
            "ch.qos.logback:logback-core:$logbackVersion",
            "ch.qos.logback:logback-classic:$logbackVersion"
    testCompile "junit:junit:$junitVersion"
}


task downloadContracts(type: Exec) {
    if (project.hasProperty("u") && project.hasProperty("p")) {
        String user = project.property("u");
        String password = project.property("p");
        commandLine("sh", "-c",
                "cd ./src/main/resources/solidity/poco\n" +
                        "rm -f -R contracts\n" +
                        "wget https://" + user + ":" + password + "@github.com/iExecBlockchainComputing/PoCo/archive/v1.0.3.tar.gz --no-check-certificate --auth-no-challenge -O poco.tar.gz\n" +
                        "tar -xvf poco.tar.gz --strip-component 2 --wildcards --no-anchored contracts\n" +
                        "rm poco.tar.gz\n" +
                        "cd contracts\n" +
                        "git clone https://" + user + ":" + password + "@github.com/iExecBlockchainComputing/rlc-token.git\n" +
                        "cd ..")
    } else {
        print("Please provide your git credentials : gradle downloadContracts -Pu=gituser -Pp=changeit")
    }
}

task buildContracts(type: Exec) {
    commandLine("sh", "-c",
            "cd ./scripts\n" +
            "./buildContracts.sh")
}



